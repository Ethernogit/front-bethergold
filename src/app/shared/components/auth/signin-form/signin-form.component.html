<!-- Modal de Selector de Organizaciones -->
@if (showOrganizationSelector) {
<div class="fixed inset-0 z-[9999] overflow-y-auto" style="z-index: 9999 !important;">
  <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
    <!-- Overlay -->
    <div class="fixed inset-0 transition-opacity bg-gray-900 bg-opacity-50 z-[9998]" aria-hidden="true"
      style="z-index: 9998 !important;"></div>

    <!-- Modal -->
    <div
      class="inline-block w-full max-w-md my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl dark:bg-gray-800 relative z-[9999]"
      style="z-index: 9999 !important;">
      <app-organization-selector [organizations]="availableOrganizations" [isLoading]="isOrgSelectionLoading"
        (organizationSelected)="onOrganizationSelected($event)"
        (cancelled)="onOrganizationSelectionCancelled()"></app-organization-selector>
    </div>
  </div>
</div>
}

<div class="min-h-screen w-full flex bg-gray-50 dark:bg-gray-900 overflow-hidden">

  <!-- Left Side: Form -->
  <div
    class="w-full lg:w-1/2 flex flex-col justify-center items-center p-8 lg:p-12 relative z-10 bg-white dark:bg-gray-900/95 backdrop-blur-sm">
    <div class="w-full max-w-md space-y-8">

      <!-- Header -->
      <div class="text-center lg:text-left">
        <h1 class="text-4xl font-bold tracking-tight text-gray-900 dark:text-white mb-2">
          Bienvenido a <span class="text-[#D4AF37]">Bether Gold</span>
        </h1>
        <p class="text-gray-500 dark:text-gray-400">
          Ingresa a tu panel de control tecnológico
        </p>
      </div>

      <!-- Error Messages -->
      @if (errorMessage) {
      <div
        class="p-4 rounded-xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 flex items-center gap-3 animate-fade-in">
        <svg class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
            clip-rule="evenodd"></path>
        </svg>
        <p class="text-sm text-red-700 dark:text-red-300 font-medium">{{ errorMessage }}</p>
      </div>
      }

      <!-- Form -->
      <form (ngSubmit)="onSignIn()" class="space-y-6 mt-8">

        <!-- Email -->
        <div class="space-y-2">
          <app-label>Correo Electrónico</app-label>
          <div class="relative group">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400 group-focus-within:text-brand-500 transition-colors">
              <i class="fas fa-envelope"></i>
            </div>
            <app-input-field type="email" placeholder="nombre@empresa.com" [(ngModel)]="email" name="email"
              class="pl-10" [class.border-red-500]="fieldErrors['email']" required />
          </div>
          @if (fieldErrors['email']) {
          <p class="text-xs text-red-500 mt-1 ml-1">{{ fieldErrors['email'] }}</p>
          }
        </div>

        <!-- Password -->
        <div class="space-y-2">
          <div class="flex items-center justify-between">
            <app-label>Contraseña</app-label>
            <a routerLink="/reset-password"
              class="text-xs font-medium text-brand-500 hover:text-brand-400 transition-colors">
              ¿Olvidaste tu contraseña?
            </a>
          </div>
          <div class="relative group">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400 group-focus-within:text-brand-500 transition-colors">
              <i class="fas fa-lock"></i>
            </div>
            <app-input-field [type]="showPassword ? 'text' : 'password'" placeholder="••••••••" [(ngModel)]="password"
              name="password" class="pl-10 pr-10" [class.border-red-500]="fieldErrors['password']" required />
            <button type="button" (click)="togglePasswordVisibility()"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors focus:outline-none">
              <i class="fas" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
            </button>
          </div>
          @if (fieldErrors['password']) {
          <p class="text-xs text-red-500 mt-1 ml-1">{{ fieldErrors['password'] }}</p>
          }
        </div>

        <!-- Remember Me -->
        <div class="flex items-center">
          <app-checkbox [(checked)]="isChecked" label="Recordar dispositivo" />
        </div>

        <!-- Submit Button -->
        <app-button className="w-full relative overflow-hidden group" size="md" [disabled]="isLoading"
          (btnClick)="onSignIn()">
          <div
            class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shimmer">
          </div>
          @if (isLoading) {
          <span class="flex items-center justify-center gap-2">
            <svg class="animate-spin h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
              </path>
            </svg>
            <span>Procesando...</span>
          </span>
          } @else {
          <span>Iniciar Sesión</span>
          }
        </app-button>
      </form>

      <!-- Footer -->
      <p class="text-center text-sm text-gray-500 dark:text-gray-400 mt-8">
        ¿No tienes una cuenta?
        <a routerLink="/signup" class="font-semibold text-brand-500 hover:text-brand-400 transition-colors">
          Regístrate aquí
        </a>
      </p>
    </div>
  </div>

  <!-- Right Side: Anime.js Animation Area -->
  <div class="hidden lg:flex w-1/2 bg-gray-900 relative overflow-hidden items-center justify-center">

    <!-- Animated Background Elements -->
    <div class="absolute inset-0" id="anime-background">
      <!-- Grid lines generated by JS or CSS -->
      <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>

      <!-- Tech Circles (Animated) -->
      <div
        class="anime-circle absolute w-96 h-96 border border-brand-500/20 rounded-full top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
      </div>
      <div
        class="anime-circle absolute w-[30rem] h-[30rem] border border-brand-500/10 rounded-full top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border-dashed">
      </div>
      <div
        class="anime-circle absolute w-[40rem] h-[40rem] border border-brand-500/5 rounded-full top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
      </div>
    </div>

    <!-- Mascot Container -->
    <div class="relative z-10 flex flex-col items-center justify-center p-12 text-center">
      <div class="relative z-10 flex flex-col items-center justify-center text-center p-8">
        <!-- Logo/Mascot -->
        <div class="relative group">
          <div
            class="absolute inset-0 bg-[#D4AF37]/20 blur-3xl rounded-full group-hover:bg-[#D4AF37]/30 transition-all duration-500">
          </div>
          <img src="/assets/images/bugjoya.png" alt="Bether Gold Mascot"
            class="relative w-48 h-48 lg:w-64 lg:h-64 object-contain drop-shadow-2xl transform transition-transform duration-500 group-hover:scale-105" />
        </div>

        <!-- Title -->
        <h2 class="text-4xl lg:text-5xl font-bold text-white mb-4 tracking-tight">
          Bether <span class="text-[#D4AF37]">Gold</span>
        </h2>

        <p class="text-gray-300 text-lg max-w-md mx-auto leading-relaxed">
          El sistema que te ayudara a gestionar tu joyeria.
        </p>
      </div>
    </div>

  </div>
</div>