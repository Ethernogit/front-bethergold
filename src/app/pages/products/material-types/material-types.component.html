<div class="mx-auto max-w-screen-2xl h-[calc(100vh-50px)] flex flex-col overflow-hidden">
    <div class="flex flex-col gap-4 h-full">
        <div
            class="rounded-2xl border border-[#E8D9A0] bg-white shadow-theme-sm dark:border-[#3D3420] dark:bg-[#252017] flex flex-col h-full">
            <!-- Header -->
            <div class="border-b border-[#E8D9A0] px-4 py-3 dark:border-[#3D3420] sm:px-6 shrink-0">
                <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                    <div>
                        <h1 class="font-outfit text-title-sm font-semibold text-[#191817] dark:text-white">Materiales
                        </h1>
                        <p class="mt-1 font-display text-theme-sm text-[#6B6560] dark:text-gray-500">Gestiona los tipos
                            de material de tus productos</p>
                    </div>
                    <button type="button" (click)="openCreateModal()"
                        class="flex items-center gap-2 rounded-xl bg-gradient-to-br from-[#C69214] to-[#FAC600] px-5 py-2.5 font-outfit text-sm font-semibold text-[#191817] shadow-theme-sm transition-all hover:from-[#9A6F0A] hover:to-[#C69214] hover:shadow-theme-md active:scale-[0.98]">
                        <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 4.5V15.5M4.5 10H15.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                        Nuevo Tipo
                    </button>
                </div>
            </div>

            <!-- Loading -->
            @if (loading() && materialTypes().length === 0) {
            <div class="flex justify-center py-10">
                <div
                    class="h-12 w-12 animate-spin rounded-full border-4 border-solid border-[#C69214] border-t-transparent">
                </div>
            </div>
            }

            <!-- Table -->
            @if (!loading() || materialTypes().length > 0) {
            <div class="flex-1 overflow-y-auto p-0 z-0">
                @if (materialTypes().length > 0) {
                <div class="relative">
                    <table class="w-full table-auto">
                        <thead class="sticky top-0 z-10 bg-[#FBF0C9] dark:bg-[#252017] shadow-sm">
                            <tr
                                class="text-left font-outfit text-theme-xs font-semibold uppercase tracking-wider text-[#9A6F0A] dark:text-[#E8C97A]">
                                <th class="px-4 py-3">Código</th>
                                <th class="px-4 py-3">Nombre</th>
                                <th class="px-4 py-3">Material Base</th>
                                <th class="px-4 py-3">Aleación</th>
                                <th class="px-4 py-3">Estado</th>
                                <th class="px-4 py-3 text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-[#E8D9A0] bg-white dark:divide-[#3D3420] dark:bg-[#1A1714]">
                            @for (type of materialTypes(); track type.id) {
                            <tr class="transition-colors hover:bg-[#FBF0C9]/40 dark:hover:bg-[#252017]">
                                <td
                                    class="px-4 py-3 font-display text-theme-sm font-medium text-[#191817] dark:text-white">
                                    {{ type.code }}</td>
                                <td class="px-4 py-3 font-display text-theme-sm text-[#46424A] dark:text-gray-300">{{
                                    type.name }}</td>
                                <td
                                    class="px-4 py-3 font-display text-theme-sm text-[#46424A] dark:text-gray-300 capitalize">
                                    {{ type.type }}</td>
                                <td class="px-4 py-3">
                                    @if (type.karat) {
                                    <span
                                        class="inline-flex items-center gap-1.5 rounded-full bg-[#FBF0C9] px-2.5 py-0.5 text-theme-xs font-medium text-[#9A6F0A] dark:bg-[#3D3420] dark:text-[#E8C97A]">{{
                                        type.karat }}k</span>
                                    } @else {
                                    <span class="font-display text-theme-sm text-[#6B6560] dark:text-gray-500">-</span>
                                    }
                                </td>
                                <td class="px-4 py-3">
                                    <span
                                        class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-theme-xs font-medium"
                                        [ngClass]="{
                                            'bg-success-50 text-success-700 dark:bg-success-500/15 dark:text-success-400': type.status === 'active',
                                            'bg-error-50 text-error-700 dark:bg-error-500/15 dark:text-error-400': type.status !== 'active'
                                        }">
                                        <span class="size-1.5 rounded-full"
                                            [ngClass]="{'bg-success-500': type.status === 'active', 'bg-error-500': type.status !== 'active'}"></span>
                                        {{ type.status === 'active' ? 'Activo' : 'Inactivo' }}
                                    </span>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <div class="flex items-center justify-center gap-2">
                                        <button type="button" (click)="openEditModal(type)"
                                            class="text-[#46424A] hover:text-[#C69214] dark:text-gray-400 dark:hover:text-[#FAC600] transition-colors p-1.5 rounded-lg hover:bg-[#FBF0C9] dark:hover:bg-[#3D3420]"
                                            title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                </path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                </path>
                                            </svg>
                                        </button>
                                        <button type="button" (click)="deleteType(type)"
                                            class="text-error-500 hover:text-error-700 dark:text-error-400 dark:hover:text-error-300 transition-colors p-1.5 rounded-lg hover:bg-error-50 dark:hover:bg-error-500/10"
                                            title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                <path
                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                </path>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
                } @else {
                <div class="flex flex-col items-center justify-center py-16 text-center">
                    <div
                        class="mb-4 flex size-16 items-center justify-center rounded-full bg-[#FBF0C9] dark:bg-[#3D3420]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                            class="text-[#C69214]">
                            <path d="M12 2L2 7l10 5 10-5-10-5z" />
                            <path d="M2 17l10 5 10-5" />
                            <path d="M2 12l10 5 10-5" />
                        </svg>
                    </div>
                    <h5 class="mb-2 font-outfit text-theme-xl font-semibold text-[#191817] dark:text-white">No hay tipos
                        de material</h5>
                    <p class="mb-6 font-display text-theme-sm text-[#6B6560] dark:text-gray-400">Comienza agregando los
                        tipos de material (Empaque, Madera, Metal, etc.).</p>
                    <button type="button" (click)="openCreateModal()"
                        class="flex items-center gap-2 rounded-xl bg-gradient-to-br from-[#C69214] to-[#FAC600] px-5 py-2.5 font-outfit text-sm font-semibold text-[#191817] shadow-theme-sm transition-all hover:from-[#9A6F0A] hover:to-[#C69214] active:scale-[0.98]">
                        <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 4.5V15.5M4.5 10H15.5" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                        Crear Tipo
                    </button>
                </div>
                }
            </div>
            }
        </div>
    </div>
</div>

<!-- Modal -->
@if (showModal()) {
<div
    class="fixed inset-0 z-50 flex items-center justify-center overflow-y-auto overflow-x-hidden bg-[#191817]/60 p-4 backdrop-blur-sm">
    <div
        class="relative w-full max-w-md rounded-2xl border border-[#E8D9A0] bg-[#FFFDF7] shadow-xl dark:border-[#3D3420] dark:bg-[#1A1714]">
        <!-- Header -->
        <div class="flex items-center justify-between border-b border-[#E8D9A0] p-5 dark:border-[#3D3420]">
            <h3 class="font-outfit text-theme-xl font-semibold text-[#191817] dark:text-white">{{ editingType() ?
                'Editar Tipo' : 'Nuevo Tipo de Material' }}</h3>
            <button type="button" (click)="closeModal()"
                class="text-[#6B6560] hover:text-[#191817] dark:text-gray-400 dark:hover:text-white transition-colors p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-white/5">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <!-- Body -->
        <div class="p-6">
            <form [formGroup]="materialForm">
                <div class="flex flex-col gap-4">
                    <div>
                        <label
                            class="mb-2 block font-display text-theme-sm font-medium text-[#46424A] dark:text-gray-300">Nombre
                            *</label>
                        <input type="text" formControlName="name" placeholder="Ej. Cartón Kraft"
                            class="w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-display text-base text-[#191817] placeholder-[#6B6560] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#3D3420] dark:bg-[#1A1714] dark:text-white dark:placeholder-gray-600 dark:focus:border-[#FAC600]"
                            [class.border-error-500]="isFieldInvalid('name')">
                        @if (isFieldInvalid('name')) { <p class="mt-1 text-theme-xs text-error-500">{{
                            getFieldError('name') }}</p> }
                    </div>
                    <div>
                        <label
                            class="mb-2 block font-display text-theme-sm font-medium text-[#46424A] dark:text-gray-300">Código
                            *</label>
                        <input type="text" formControlName="code" placeholder="Ej. AU10"
                            class="uppercase w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-display text-base text-[#191817] placeholder-[#6B6560] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#3D3420] dark:bg-[#1A1714] dark:text-white dark:placeholder-gray-600 dark:focus:border-[#FAC600]"
                            [class.border-error-500]="isFieldInvalid('code')">
                        @if (isFieldInvalid('code')) { <p class="mt-1 text-theme-xs text-error-500">{{
                            getFieldError('code') }}</p> }
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label
                                class="mb-2 block font-display text-theme-sm font-medium text-[#46424A] dark:text-gray-300">Material
                                Base *</label>
                            <select formControlName="type"
                                class="w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-display text-base text-[#191817] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#3D3420] dark:bg-[#1A1714] dark:text-white dark:focus:border-[#FAC600]">
                                <option value="">Seleccionar...</option>
                                @for (opt of materialTypeOptions; track opt.value) {
                                <option [value]="opt.value">{{ opt.label }}</option>
                                }
                            </select>
                        </div>
                        <div>
                            <label
                                class="mb-2 block font-display text-theme-sm font-medium text-[#46424A] dark:text-gray-300">
                                Aleación (K, Ley)
                                @if(isGold()) { <span class="text-error-500">*</span> }
                            </label>
                            <input type="text" formControlName="karat" placeholder="Ej. 10k, 14k, 925"
                                class="w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-display text-base text-[#191817] placeholder-[#6B6560] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#3D3420] dark:bg-[#1A1714] dark:text-white dark:placeholder-gray-600 dark:focus:border-[#FAC600]">
                        </div>
                    </div>
                    <div>
                        <label
                            class="mb-2 block font-display text-theme-sm font-medium text-[#46424A] dark:text-gray-300">Descripción</label>
                        <textarea formControlName="description" rows="3"
                            class="w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-display text-base text-[#191817] placeholder-[#6B6560] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#3D3420] dark:bg-[#1A1714] dark:text-white dark:placeholder-gray-600 dark:focus:border-[#FAC600]"></textarea>
                    </div>
                </div>
            </form>
        </div>
        <!-- Footer -->
        <div class="flex items-center justify-end gap-3 border-t border-[#E8D9A0] p-5 dark:border-[#3D3420]">
            <button type="button" (click)="closeModal()"
                class="flex items-center gap-2 rounded-xl px-5 py-2.5 font-outfit text-sm font-medium text-[#46424A] transition-all hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-white/5">
                Cancelar
            </button>
            <button type="button" [disabled]="loading()" (click)="saveType()"
                class="flex items-center gap-2 rounded-xl bg-gradient-to-br from-[#C69214] to-[#FAC600] px-5 py-2.5 font-outfit text-sm font-semibold text-[#191817] shadow-theme-sm transition-all hover:from-[#9A6F0A] hover:to-[#C69214] active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-50">
                @if (loading()) {
                <svg class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
                }
                {{ editingType() ? 'Actualizar' : 'Crear' }}
            </button>
        </div>
    </div>
</div>
}