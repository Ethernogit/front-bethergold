<div class="min-h-screen bg-gray-50 dark:bg-[#0b1120] relative flex">
    <!-- Sidebar -->
    <!-- Assuming Sidebar is in app-layout, not here. If it was here, we'd preserve it.
         Based on previous file, there was no sidebar component *inside* this file, 
         so we assume it's handled by a parent layout. -->

    <!-- Main Content -->
    <main class="w-full h-screen overflow-hidden flex flex-col">
        <!-- Header (Fixed) -->
        <header class="bg-white dark:bg-[#1a2230] border-b border-gray-200 dark:border-[#2a364a] flex-shrink-0 z-20">
            <div class="px-6 py-4">
                <!-- Top Row: Back link & Refresh/Actions -->
                <div class="flex items-center justify-between mb-4">
                    <a routerLink="/sales/history"
                        class="flex items-center gap-2 text-gray-500 hover:text-primary transition-colors cursor-pointer group">
                        <span
                            class="material-symbols-outlined group-hover:-translate-x-1 transition-transform">arrow_back</span>
                        <span class="font-medium text-sm">Volver al listado</span>
                    </a>
                    <button class="text-gray-400 hover:text-primary transition-colors">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                </div>

                <!-- Main Title Row -->
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <div
                            class="size-12 rounded-lg bg-gray-100 dark:bg-[#111722] flex items-center justify-center text-gray-500 dark:text-gray-400">
                            <span class="material-symbols-outlined text-2xl">receipt_long</span>
                        </div>
                        <div>
                            <div
                                class="text-xs text-gray-500 dark:text-[#92a4c9] font-medium tracking-wide uppercase mb-0.5">
                                Orden de Venta</div>
                            <h1 class="text-2xl font-bold text-gray-900 dark:text-white leading-none">
                                {{note?.id || 'Cargando...'}}
                            </h1>
                        </div>
                    </div>

                    <!-- Middle Info: Order Details -->
                    <div
                        class="hidden xl:flex items-center gap-8 border-l border-gray-200 dark:border-[#2a364a] pl-8 ml-4 mr-auto">
                        <!-- Date -->
                        <div>
                            <div
                                class="text-[10px] font-bold text-gray-500 dark:text-[#92a4c9] uppercase tracking-wider mb-0.5">
                                Fecha</div>
                            <div class="text-sm font-bold text-gray-900 dark:text-white">{{note?.dateCreated}}</div>
                        </div>
                        <!-- Location -->
                        <div>
                            <div
                                class="text-[10px] font-bold text-gray-500 dark:text-[#92a4c9] uppercase tracking-wider mb-0.5">
                                Sucursal</div>
                            <div class="text-sm font-bold text-gray-900 dark:text-white">{{note?.location}}</div>
                        </div>
                        <!-- Agent -->
                        <div>
                            <div
                                class="text-[10px] font-bold text-gray-500 dark:text-[#92a4c9] uppercase tracking-wider mb-0.5">
                                Vendedor</div>
                            <div class="flex items-center gap-2">
                                <div
                                    class="size-5 rounded-full bg-primary/10 text-primary flex items-center justify-center text-[10px] font-bold">
                                    {{note?.agent?.charAt(0)}}
                                </div>
                                <span class="text-sm font-bold text-gray-900 dark:text-white">{{note?.agent}}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Status Badge -->
                    <div class="flex items-center gap-3 flex-shrink-0">
                        <!-- Print Button -->
                        <button (click)="printNote()"
                            class="bg-white dark:bg-[#1a2230] text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 font-medium px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm">
                            <span class="material-symbols-outlined text-[20px]">print</span>
                            <span class="hidden sm:inline">Imprimir</span>
                        </button>

                        <!-- Pay Button (Conditional) -->
                        <button *ngIf="financials?.balance > 0" (click)="openPaymentModal()"
                            class="bg-primary hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm">
                            <span class="material-symbols-outlined text-[20px]">payments</span>
                            <span>Abonar</span>
                        </button>

                        <span *ngIf="note" [ngClass]="{
                            'bg-green-600 text-white border-green-700 shadow-lg shadow-green-500/30': note.status === 'Pagado' || note.status === 'Entregado',
                            'bg-amber-500 text-white border-amber-600 shadow-lg shadow-amber-500/30': note.status === 'Pago Pendiente',
                            'bg-gray-500 text-white border-gray-600': note.status === 'Borrador',
                            'bg-red-500 text-white border-red-600': note.status === 'Anulada'
                        }"
                            class="px-5 py-2 rounded-full text-base font-bold border flex items-center gap-2 transition-all transform hover:scale-105">
                            <span class="material-symbols-outlined text-[22px] font-bold"
                                *ngIf="note.status === 'Pagado' || note.status === 'Entregado'">check_circle</span>
                            <span class="material-symbols-outlined text-[22px] font-bold"
                                *ngIf="note.status === 'Pago Pendiente'">hourglass_empty</span>
                            <span class="material-symbols-outlined text-[22px] font-bold"
                                *ngIf="note.status === 'Borrador'">edit_note</span>
                            <span class="material-symbols-outlined text-[22px] font-bold"
                                *ngIf="note.status === 'Anulada'">cancel</span>
                            {{note.status | uppercase}}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Summary Bar (Stats) -->
            <div
                class="px-6 py-3 bg-gray-50/50 dark:bg-[#111722]/50 border-t border-gray-200 dark:border-[#2a364a] flex overflow-x-auto gap-4 md:gap-8 hide-scrollbar">
                <div class="flex items-center gap-3 pr-4 border-r border-gray-200 dark:border-[#2a364a] last:border-0">
                    <div class="text-xs font-medium text-gray-500 dark:text-[#92a4c9] uppercase">Total</div>
                    <span class="text-base font-bold text-gray-900 dark:text-white">${{financials?.total |
                        number:'1.2-2'}}</span>
                </div>
                <!-- Paid (Acuenta) -->
                <div *ngIf="financials?.paid > 0"
                    class="flex items-center gap-3 pr-4 border-r border-gray-200 dark:border-[#2a364a] last:border-0">
                    <div class="text-xs font-medium text-gray-500 dark:text-[#92a4c9] uppercase">Acuenta</div>
                    <span class="text-sm font-bold text-green-600 dark:text-green-400">${{financials?.paid |
                        number:'1.2-2'}}</span>
                </div>
                <!-- Remaining (Restante) -->
                <div *ngIf="financials?.balance > 0"
                    class="flex items-center gap-3 pr-4 border-r border-gray-200 dark:border-[#2a364a] last:border-0">
                    <div class="text-xs font-medium text-gray-500 dark:text-[#92a4c9] uppercase">Restante</div>
                    <span class="text-sm font-bold text-red-500 dark:text-red-400">${{financials?.balance |
                        number:'1.2-2'}}</span>
                </div>

                <div class="flex items-center gap-3 last:border-0 pl-4 border-l border-gray-200 dark:border-[#2a364a]">
                    <span class="text-xs font-medium text-gray-500 dark:text-[#92a4c9] uppercase">CLIENTE:</span>
                    <div class="flex items-center gap-4 text-sm text-gray-900 dark:text-white">
                        <span
                            class="font-bold border-r border-gray-300 dark:border-gray-600 pr-3 mr-1">{{client?.name}}</span>

                        <span class="flex items-center gap-1" *ngIf="client?.phone">
                            <span class="font-medium text-gray-500 dark:text-gray-400">Tel:</span>
                            <span>{{client?.phone}}</span>
                        </span>

                        <span class="flex items-center gap-1" *ngIf="client?.email">
                            <span class="font-medium text-gray-500 dark:text-gray-400">Email:</span>
                            <span class="truncate max-w-[200px]">{{client?.email}}</span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="px-6 flex gap-2 overflow-x-auto hide-scrollbar items-center">
                <button (click)="setTab('general')"
                    [ngClass]="currentTab === 'general' ? 'bg-primary/10 dark:bg-white/10 text-primary dark:text-white shadow-sm' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-white/5'"
                    class="px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 whitespace-nowrap">
                    <span class="material-symbols-outlined text-[20px]">info</span>
                    Información
                </button>
                <button (click)="setTab('items')"
                    [ngClass]="currentTab === 'items' ? 'bg-primary/10 dark:bg-white/10 text-primary dark:text-white shadow-sm' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-white/5'"
                    class="px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 whitespace-nowrap">
                    <span class="material-symbols-outlined text-[20px]">inventory_2</span>
                    Productos
                    <span
                        [ngClass]="currentTab === 'items' ? 'bg-primary text-white dark:bg-white dark:text-[#1a2230]' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300'"
                        class="px-1.5 py-0.5 rounded text-xs transition-colors">
                        {{(items.reserved.length + items.workshop.length + items.custom.length)}}
                    </span>
                </button>
                <button (click)="setTab('payments')"
                    [ngClass]="currentTab === 'payments' ? 'bg-primary/10 dark:bg-white/10 text-primary dark:text-white shadow-sm' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-white/5'"
                    class="px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 whitespace-nowrap">
                    <span class="material-symbols-outlined text-[20px]">payments</span>
                    Pagos / Historial
                </button>
            </div>
        </header>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex-1 flex items-center justify-center bg-gray-50 dark:bg-[#0b1120]">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"></div>
        </div>

        <!-- Error State -->
        <div *ngIf="error && !isLoading"
            class="flex-1 flex items-center justify-center bg-gray-50 dark:bg-[#0b1120] p-4 text-center">
            <div class="max-w-md bg-white dark:bg-[#1a2230] p-8 rounded-xl shadow-lg">
                <span class="material-symbols-outlined text-6xl text-red-500 mb-4">error</span>
                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Error al cargar</h3>
                <p class="text-gray-500 dark:text-[#92a4c9] mb-6">{{error}}</p>
                <button (click)="loadNote(note?.id || '')"
                    class="px-6 py-2 bg-primary text-white rounded-lg font-medium hover:bg-opacity-90 transition-all">
                    Reintentar
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div *ngIf="!isLoading && !error" class="flex-1 overflow-y-auto bg-gray-50 dark:bg-[#0b1120] p-4 lg:p-8">
            <div class="max-w-[1200px] mx-auto">

                <!-- TAB 1: General Info -->
                <div *ngIf="currentTab === 'general'" class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fadeIn">

                    <!-- Main Column: Financials -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Payment Summary -->
                        <div
                            class="bg-white dark:bg-[#1a2230] border border-gray-200 dark:border-[#2a364a] rounded-xl overflow-hidden shadow-sm relative">
                            <div class="h-1.5 w-full bg-gradient-to-r from-primary to-blue-400 absolute top-0"></div>
                            <div class="p-6">
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6">Resumen Financiero</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-500 dark:text-[#92a4c9]">Subtotal</span>
                                        <span class="font-medium text-gray-900 dark:text-white">${{financials?.subtotal
                                            | number:'1.2-2'}}</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-500 dark:text-[#92a4c9]">Impuestos</span>
                                        <span class="font-medium text-gray-900 dark:text-white">${{financials?.tax |
                                            number:'1.2-2'}}</span>
                                    </div>
                                    <div class="border-t border-gray-100 dark:border-[#2a364a] my-2"></div>
                                    <div class="flex justify-between items-end">
                                        <span class="text-lg font-bold text-gray-900 dark:text-white">Total</span>
                                        <span
                                            class="text-2xl font-bold text-gray-900 dark:text-white">${{financials?.total
                                            | number:'1.2-2'}}</span>
                                    </div>

                                    <div
                                        class="bg-gray-50 dark:bg-[#111722] rounded-lg p-4 mt-4 space-y-3 border border-gray-100 dark:border-[#2a364a]">
                                        <div class="flex justify-between items-center text-sm">
                                            <span
                                                class="text-green-600 dark:text-green-400 font-medium flex items-center gap-1">
                                                <span class="material-symbols-outlined text-[16px]">check_circle</span>
                                                Pagado
                                            </span>
                                            <span
                                                class="font-bold text-green-600 dark:text-green-400">${{financials?.paid
                                                | number:'1.2-2'}}</span>
                                        </div>
                                        <div class="flex justify-between items-center text-sm">
                                            <span class="text-primary font-bold uppercase tracking-wide">Saldo
                                                Pendiente</span>
                                            <span class="font-extrabold text-primary text-lg">${{financials?.balance |
                                                number:'1.2-2'}}</span>
                                        </div>
                                    </div>
                                </div>
                                <button (click)="setTab('payments')"
                                    class="w-full mt-6 py-3 bg-primary text-white rounded-lg font-bold hover:bg-opacity-90 transition-all flex items-center justify-center gap-2">
                                    Ir a Pagos
                                    <span class="material-symbols-outlined text-sm">arrow_forward</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Notes -->
                    <div class="space-y-6">
                        <!-- Private Notes -->
                        <div
                            class="bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-800/30 rounded-xl p-6 h-full">
                            <h3
                                class="text-sm font-bold text-amber-800 dark:text-amber-400 mb-4 flex items-center gap-2">
                                <span class="material-symbols-outlined">lock</span> Notas Privadas
                            </h3>
                            <p
                                class="text-sm text-gray-700 dark:text-gray-300 italic whitespace-pre-wrap leading-relaxed">
                                "{{note?.privateNotes || 'No hay notas privadas registradas.'}}"
                            </p>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: Items -->
                <div *ngIf="currentTab === 'items'" class="space-y-8 animate-fadeIn">
                    <!-- Products -->
                    <section *ngIf="items.reserved.length > 0">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                <span class="material-symbols-outlined text-amber-500">inventory_2</span>
                                Apartados
                            </h3>
                            <span
                                class="text-xs bg-gray-100 dark:bg-[#1a2230] text-gray-500 dark:text-[#92a4c9] px-2 py-1 rounded font-medium">{{items.reserved.length}}
                                Ítems</span>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a2230] border border-gray-200 dark:border-[#2a364a] rounded-xl overflow-hidden shadow-sm">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm text-gray-500 dark:text-gray-400">
                                    <thead
                                        class="bg-gray-50 dark:bg-[#111722] text-xs uppercase text-gray-700 dark:text-[#92a4c9]">
                                        <tr>
                                            <th class="px-6 py-4 font-bold">Codebar</th>
                                            <th class="px-6 py-4 font-bold">Producto</th>
                                            <th class="px-6 py-4 font-bold">Estado</th>
                                            <th class="px-6 py-4 font-bold text-right">Precio</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-100 dark:divide-[#2a364a]">
                                        <tr *ngFor="let item of items.reserved">
                                            <td class="px-6 py-4 font-medium">{{item.ref}}</td>
                                            <td class="px-6 py-4">
                                                <div>
                                                    <div class="font-bold text-gray-900 dark:text-white">
                                                        {{item.name}}</div>
                                                    <div class="text-xs text-gray-500 dark:text-[#92a4c9]">
                                                        {{item.description}}</div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="px-2 py-1 rounded bg-amber-50 text-amber-600 dark:bg-amber-900/20 dark:text-amber-400 border border-amber-100 dark:border-amber-800 text-xs font-bold">{{item.status}}</span>
                                            </td>
                                            <td class="px-6 py-4 text-right font-bold text-gray-900 dark:text-white">
                                                ${{item.price | number:'1.2-2'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                    <!-- Workshop -->
                    <section *ngIf="items.workshop.length > 0">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                <span class="material-symbols-outlined text-blue-500">build</span>
                                Servicios de Taller
                            </h3>
                            <span
                                class="text-xs bg-gray-100 dark:bg-[#1a2230] text-gray-500 dark:text-[#92a4c9] px-2 py-1 rounded font-medium">{{items.workshop.length}}
                                Servicios</span>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a2230] border border-gray-200 dark:border-[#2a364a] rounded-xl overflow-hidden shadow-sm">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm text-gray-500 dark:text-gray-400">
                                    <thead
                                        class="bg-gray-50 dark:bg-[#111722] text-xs uppercase text-gray-700 dark:text-[#92a4c9]">
                                        <tr>
                                            <th class="px-6 py-4 font-bold">Servicio</th>
                                            <th class="px-6 py-4 font-bold">Job ID</th>
                                            <th class="px-6 py-4 font-bold">Entrega Est.</th>
                                            <th class="px-6 py-4 font-bold">Estado</th>
                                            <th class="px-6 py-4 font-bold text-right">Costo</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-100 dark:divide-[#2a364a]">
                                        <tr *ngFor="let item of items.workshop">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="size-10 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-500">
                                                        <span class="material-symbols-outlined">ring_volume</span>
                                                    </div>
                                                    <span
                                                        class="font-bold text-gray-900 dark:text-white">{{item.title}}</span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 font-medium">{{item.jobId}}</td>
                                            <td class="px-6 py-4">{{item.estReady}}</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="px-2 py-1 rounded bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400 border border-purple-100 dark:border-purple-800 text-xs font-bold">{{item.status}}</span>
                                            </td>
                                            <td class="px-6 py-4 text-right font-bold text-gray-900 dark:text-white">
                                                ${{item.price | number:'1.2-2'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                    <!-- Custom -->
                    <section *ngIf="items.custom.length > 0">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                <span class="material-symbols-outlined text-pink-500">diamond</span>
                                Hechuras / Personalizados
                            </h3>
                            <span
                                class="text-xs bg-gray-100 dark:bg-[#1a2230] text-gray-500 dark:text-[#92a4c9] px-2 py-1 rounded font-medium">{{items.custom.length}}
                                Trabajos</span>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a2230] border border-gray-200 dark:border-[#2a364a] rounded-xl overflow-hidden shadow-sm">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm text-gray-500 dark:text-gray-400">
                                    <thead
                                        class="bg-gray-50 dark:bg-[#111722] text-xs uppercase text-gray-700 dark:text-[#92a4c9]">
                                        <tr>
                                            <th class="px-6 py-4 font-bold">Código</th>
                                            <th class="px-6 py-4 font-bold">Descripción</th>
                                            <th class="px-6 py-4 font-bold">Fecha Entrega</th>
                                            <th class="px-6 py-4 font-bold text-right">Precio Est.</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-100 dark:divide-[#2a364a]">
                                        <tr *ngFor="let item of items.custom">
                                            <td class="px-6 py-4 font-medium text-xs">{{item.jobId}}</td>
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="size-10 rounded-full bg-pink-50 dark:bg-pink-900/20 flex items-center justify-center text-pink-500 shrink-0">
                                                        <span class="material-symbols-outlined">diamond</span>
                                                    </div>
                                                    <div>
                                                        <div class="font-bold text-gray-900 dark:text-white">
                                                            {{item.title}}</div>
                                                        <div class="text-xs text-gray-500 dark:text-[#92a4c9]">
                                                            {{item.description}}</div>
                                                        <span *ngIf="item.isHechura"
                                                            class="mt-1 inline-block px-1.5 py-0.5 rounded text-[10px] font-bold bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-400 border border-teal-200 dark:border-teal-800 uppercase">
                                                            Hechura
                                                        </span>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 text-sm">{{item.estReady}}</td>
                                            <td class="px-6 py-4 text-right font-bold text-gray-900 dark:text-white">
                                                ${{item.price | number:'1.2-2'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- TAB 3: Payments -->
                <div *ngIf="currentTab === 'payments'" class="space-y-6 animate-fadeIn">
                    <div
                        class="bg-white dark:bg-[#1a2230] border border-gray-200 dark:border-[#2a364a] rounded-xl p-6 shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white">Transacciones & Pagos</h3>
                            <button (click)="openPaymentModal()"
                                class="px-4 py-2 bg-primary text-white text-sm font-bold rounded-lg shadow hover:bg-opacity-90 transition-all flex items-center gap-2">
                                <span class="material-symbols-outlined">payments</span>
                                Nuevo Pago
                            </button>
                        </div>

                        <div *ngIf="financials.transactions.length === 0"
                            class="p-12 text-center text-gray-500 dark:text-[#92a4c9]">
                            <span class="material-symbols-outlined text-4xl mb-2 opacity-50">receipt</span>
                            <p>No hay transacciones registradas.</p>
                        </div>

                        <div *ngIf="financials.transactions.length > 0"
                            class="overflow-hidden rounded-lg border border-gray-100 dark:border-[#2a364a]">
                            <table class="w-full text-left text-sm text-gray-500 dark:text-gray-400">
                                <thead
                                    class="bg-gray-50 dark:bg-[#111722] text-xs uppercase text-gray-700 dark:text-[#92a4c9]">
                                    <tr>
                                        <th class="px-6 py-4 font-bold">Fecha</th>
                                        <th class="px-6 py-4 font-bold">Tipo</th>
                                        <th class="px-6 py-4 font-bold">Método</th>
                                        <th class="px-6 py-4 font-bold text-right">Monto</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100 dark:divide-[#2a364a]">
                                    <tr *ngFor="let txn of financials.transactions">
                                        <td class="px-6 py-4 font-medium">{{txn.date}}</td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="flex items-center gap-1 text-green-600 dark:text-green-400 font-bold">
                                                <span
                                                    class="material-symbols-outlined text-[16px]">arrow_downward</span>
                                                Abono
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 font-medium">{{txn.type}}</td>
                                        <td class="px-6 py-4 text-right font-bold text-green-600 dark:text-green-400">
                                            +${{txn.amount | number:'1.2-2'}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Placeholder for Global Payment Module -->
                    <!-- <div
                        class="bg-gray-50 dark:bg-[#111722]/50 border-2 border-dashed border-gray-300 dark:border-[#2a364a] rounded-xl p-8 text-center">
                        <p class="text-gray-500 dark:text-[#92a4c9] font-medium">Módulo de Pago Global Próximamente...
                        </p>
                    </div> -->
                </div>

            </div>
            <!-- Footer Spacer -->
            <div class="h-20"></div>
        </div>
    </main>

    <!-- Global Payment Modal -->
    <app-global-payment [isOpen]="showPaymentModal()" [note]="rawNote" (close)="showPaymentModal.set(false)"
        (paymentSuccess)="onPaymentSuccess($event)">
    </app-global-payment>
</div>