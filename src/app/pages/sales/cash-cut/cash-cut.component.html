<div class="p-4 lg:p-6 max-w-7xl mx-auto space-y-4 lg:space-y-6 animate-fade-in-up font-instrument">

    <!-- Header (Only when NO active shift) -->
    <div *ngIf="!hasOpenShift || !report"
        class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            <h1 class="font-instrument text-title-md font-semibold text-[#191817] dark:text-white">
                üí∞ Corte de Caja
            </h1>
            <p class="mt-1 font-instrument text-theme-sm text-[#6B6560] dark:text-gray-500">Administra el flujo de
                efectivo y cierres de turno.</p>
        </div>

        <div class="flex items-center gap-3">
            <a routerLink="/sales/cash-history"
                class="flex items-center gap-2 rounded-xl border border-[#E8D9A0] bg-white px-5 py-2.5 font-instrument text-sm font-semibold text-[#191817] shadow-theme-sm transition-all hover:bg-[#FBF0C9] dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:hover:bg-[#3a383d]">
                <span>üìö Ver Historial</span>
            </a>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center h-64">
        <div class="h-12 w-12 animate-spin rounded-full border-4 border-solid border-[#C69214] border-t-transparent">
        </div>
    </div>

    <!-- NO CAJA ABIERTA (Open Shift Form) -->
    <div *ngIf="!isLoading && !hasOpenShift" class="flex justify-center items-center py-12">
        <div
            class="bg-[#FFFDF7] dark:bg-[#232126] rounded-2xl shadow-theme-lg p-8 max-w-md w-full border border-[#E8D9A0] dark:border-[#4A474D]">
            <div class="text-center mb-6">
                <div
                    class="flex h-16 w-16 items-center justify-center rounded-full bg-[#FBF0C9] text-[#C69214] mx-auto mb-4 text-2xl dark:bg-[#3D3420] dark:text-[#E8C97A]">
                    üîì
                </div>
                <h2 class="font-instrument text-title-sm font-semibold text-[#191817] dark:text-white">Abrir Caja</h2>
                <p class="mt-1 font-instrument text-theme-sm text-[#6B6560] dark:text-gray-500">Ingresa el fondo inicial
                    para comenzar el
                    turno.</p>
            </div>

            <form [formGroup]="openShiftForm" (ngSubmit)="openShift()" class="space-y-4">
                <div>
                    <label
                        class="font-instrument text-theme-sm font-medium text-[#46424A] dark:text-gray-300 block mb-1">Fondo
                        Inicial</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">$</span>
                        <input type="number" formControlName="initialAmount"
                            class="w-full pl-8 pr-4 py-2.5 rounded-xl border border-[#E8D9A0] dark:border-[#4A474D] bg-white dark:bg-[#232126] text-[#191817] dark:text-white font-instrument text-base outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:focus:border-[#FAC600]"
                            placeholder="0.00">
                    </div>
                </div>

                <button type="submit" [disabled]="openShiftForm.invalid || isLoading"
                    class="w-full flex items-center justify-center gap-2 rounded-xl bg-gradient-to-br from-[#C69214] to-[#FAC600] py-3 font-instrument text-sm font-semibold text-[#191817] shadow-theme-sm transition-all hover:from-[#9A6F0A] hover:to-[#C69214] hover:shadow-theme-md active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-50">
                    <span *ngIf="!isLoading">Abrir Turno</span>
                    <span *ngIf="isLoading" class="flex justify-center items-center gap-2">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        Procesando...
                    </span>
                </button>
            </form>
        </div>
    </div>

    <!-- CAJA ABIERTA (Dashboard) -->
    <div *ngIf="!isLoading && hasOpenShift && report" class="space-y-6">

        <!-- Top Header & KPIs -->
        <div class="flex flex-col gap-4">
            <!-- Active Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
                <div>
                    <h1 class="font-instrument text-title-md font-semibold text-[#191817] dark:text-white">
                        üí∞ Corte de Caja
                    </h1>
                    <p class="mt-1 font-instrument text-theme-sm text-[#6B6560] dark:text-gray-500">Administra el flujo
                        de efectivo y cierres de turno.</p>
                </div>

                <div class="flex items-center gap-3">
                    <a routerLink="/sales/cash-history"
                        class="flex items-center gap-2 rounded-xl border border-[#E8D9A0] bg-white px-5 py-2.5 font-instrument text-sm font-semibold text-[#191817] shadow-theme-sm transition-all hover:bg-[#FBF0C9] dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:hover:bg-[#3a383d]">
                        <span>üìö Ver Historial</span>
                    </a>

                    <div
                        class="bg-[#FBF0C9] dark:bg-[#3D3420] px-3 py-1.5 rounded-xl border border-[#E8D9A0] dark:border-[#4A474D]">
                        <div
                            class="flex items-center gap-2 font-instrument text-theme-xs font-medium text-[#9A6F0A] dark:text-[#E8C97A]">
                            <i class="fas fa-clock"></i>
                            <span>Abierto el {{ report.shift.startDate | date:'shortTime' }} por <strong>{{
                                    report.shift.openedBy?.name?.split(' ')[0] || '---' }}</strong></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Horizontal KPIs -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <div
                    class="bg-[#FFFDF7] dark:bg-[#232126] p-3 rounded-xl border border-[#E8D9A0] dark:border-[#4A474D] shadow-theme-sm flex flex-col justify-center">
                    <p class="font-instrument text-[11px] font-medium text-[#6B6560] dark:text-gray-400">Ventas
                        (Efectivo)</p>
                    <div class="mt-0.5 font-instrument text-base font-bold text-success-600 dark:text-success-400">{{
                        report.financials.sales.cash | currency }}</div>
                </div>
                <div
                    class="bg-[#FFFDF7] dark:bg-[#232126] p-3 rounded-xl border border-[#E8D9A0] dark:border-[#4A474D] shadow-theme-sm flex flex-col justify-center">
                    <p class="font-instrument text-[11px] font-medium text-[#6B6560] dark:text-gray-400">Ventas
                        (Tarj/Transf)</p>
                    <div class="mt-0.5 font-instrument text-base font-bold text-[#9A6F0A] dark:text-[#E8C97A]">{{
                        (report.financials.sales.card + report.financials.sales.transfer) | currency }}</div>
                </div>
                <div
                    class="bg-[#FFFDF7] dark:bg-[#232126] p-3 rounded-xl border border-[#E8D9A0] dark:border-[#4A474D] shadow-theme-sm flex flex-col justify-center">
                    <p class="font-instrument text-[11px] font-medium text-[#6B6560] dark:text-gray-400">Entradas /
                        Fondo</p>
                    <div class="mt-0.5 font-instrument text-base font-bold text-[#C69214] dark:text-[#FAC600]">{{
                        (report.financials.movements.in + report.financials.initialAmount) | currency }}</div>
                </div>
                <div
                    class="bg-[#FFFDF7] dark:bg-[#232126] p-3 rounded-xl border border-[#E8D9A0] dark:border-[#4A474D] shadow-theme-sm flex flex-col justify-center">
                    <p class="font-instrument text-[11px] font-medium text-[#6B6560] dark:text-gray-400">Salidas /
                        Gastos</p>
                    <div class="mt-0.5 font-instrument text-base font-bold text-error-600 dark:text-error-400">{{
                        report.financials.movements.out | currency }}</div>
                </div>
                <div
                    class="bg-[#FFFDF7] dark:bg-[#232126] p-3 rounded-xl border border-[#E8D9A0] dark:border-[#4A474D] shadow-theme-sm flex flex-col justify-center bg-gradient-to-br dark:from-[#232126] dark:to-[#2A271C] from-[#FFFDF7] to-[#FBF0C9]">
                    <p class="font-instrument text-[11px] font-bold text-[#6B6560] dark:text-gray-400">Total en
                        Caja (Sistema)</p>
                    <div class="mt-0.5 font-instrument text-title-sm font-extrabold text-[#C69214] dark:text-[#FAC600]">
                        {{
                        report.financials.expectedCashInDrawer | currency }}</div>
                </div>
            </div>
        </div>

        <!-- 3-Column Content Layout (Sales | Movements | Checkout) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">

            <!-- Col 1: Ventas y Abonos -->
            <div class="col-span-1 flex flex-col gap-6">
                <div
                    class="overflow-hidden rounded-2xl border border-[#E8D9A0] shadow-theme-sm dark:border-[#4A474D] bg-white dark:bg-[#232126]">
                    <div class="flex items-center justify-between border-b border-[#E8D9A0] p-4 dark:border-[#4A474D]">
                        <h3
                            class="font-instrument text-theme-xl font-semibold text-[#191817] dark:text-white flex items-center gap-2">
                            <i class="fas fa-shopping-cart text-[#C69214]"></i> Ventas y Abonos
                        </h3>
                        <span
                            class="inline-flex items-center gap-1.5 rounded-full bg-[#FBF0C9] px-2.5 py-0.5 text-theme-xs font-medium text-[#9A6F0A] dark:bg-[#3D3420] dark:text-[#E8C97A]">
                            {{ report.financials.sales.details?.length || 0 }}
                        </span>
                    </div>
                    <div class="overflow-x-auto max-h-[500px] custom-scrollbar">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-[#FBF0C9] dark:bg-[#232126] sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th
                                        class="px-4 py-3 text-left font-instrument text-theme-xs font-semibold uppercase tracking-wider text-[#9A6F0A] dark:text-[#E8C97A]">
                                        Folio</th>
                                    <th
                                        class="px-4 py-3 text-left font-instrument text-theme-xs font-semibold uppercase tracking-wider text-[#9A6F0A] dark:text-[#E8C97A]">
                                        M√©todo</th>
                                    <th
                                        class="px-4 py-3 text-right font-instrument text-theme-xs font-semibold uppercase tracking-wider text-[#9A6F0A] dark:text-[#E8C97A]">
                                        Monto</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-[#E8D9A0] bg-white dark:divide-[#3D3420] dark:bg-[#232126]">
                                <tr
                                    *ngIf="!report.financials.sales.details || report.financials.sales.details.length === 0">
                                    <td colspan="3"
                                        class="px-4 py-10 text-center font-display text-[#46424A] dark:text-gray-400">
                                        No hay ventas.
                                    </td>
                                </tr>
                                <tr *ngFor="let payment of report.financials.sales.details"
                                    class="transition-colors hover:bg-[#FBF0C9]/40 dark:hover:bg-[#252017]">
                                    <td
                                        class="px-4 py-3 font-instrument text-theme-sm font-medium text-[#C69214] hover:underline cursor-pointer">
                                        {{ payment.folio }}</td>
                                    <td class="px-4 py-3">
                                        <div class="flex items-center gap-1.5">
                                            <i class="fas text-xs" [ngClass]="{
                                                'fa-money-bill-wave text-success-500': payment.paymentMethod === 'cash',
                                                'fa-credit-card text-[#9A6F0A]': payment.paymentMethod === 'card',
                                                'fa-exchange-alt text-[#C69214]': payment.paymentMethod === 'transfer'
                                            }"></i>
                                            <span class="capitalize text-theme-xs" [ngClass]="{
                                                'text-success-600 dark:text-success-400': payment.paymentMethod === 'cash',
                                                'text-[#9A6F0A] dark:text-[#E8C97A]': payment.paymentMethod === 'card',
                                                'text-[#C69214] dark:text-[#FAC600]': payment.paymentMethod === 'transfer'
                                            }">{{ payment.paymentMethod === 'cash' ? 'Efect.' : payment.paymentMethod
                                                === 'card' ? 'Tarj.' : 'Transf.' }}</span>
                                        </div>
                                    </td>
                                    <td
                                        class="px-4 py-3 text-right font-instrument text-theme-sm font-medium text-[#191817] dark:text-white">
                                        {{ payment.paymentAmount | currency }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Col 2: Movimientos -->
            <div class="col-span-1 flex flex-col gap-6">
                <div
                    class="overflow-hidden rounded-2xl border border-[#E8D9A0] shadow-theme-sm dark:border-[#4A474D] bg-white dark:bg-[#232126]">
                    <div class="flex flex-col gap-3 border-b border-[#E8D9A0] p-4 dark:border-[#4A474D]">
                        <h3
                            class="font-instrument text-theme-xl font-semibold text-[#191817] dark:text-white flex items-center gap-2">
                            <i class="fas fa-exchange-alt text-[#C69214]"></i> Movimientos
                        </h3>
                        <div class="flex gap-2">
                            <button (click)="openMovementModal('OUT')"
                                class="flex-1 flex justify-center items-center gap-1 rounded-xl border border-error-500 bg-transparent px-3 py-1.5 font-instrument text-theme-xs font-medium text-error-600 transition-all hover:bg-error-50 dark:hover:bg-error-500/10">
                                - Gasto
                            </button>
                            <button (click)="openMovementModal('IN')"
                                class="flex-1 flex justify-center items-center gap-1 rounded-xl border border-[#C69214] bg-transparent px-3 py-1.5 font-instrument text-theme-xs font-medium text-[#C69214] transition-all hover:bg-[#FBF0C9] dark:hover:bg-[#3D3420]">
                                + Ingreso
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto max-h-[430px] custom-scrollbar">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-[#FBF0C9] dark:bg-[#232126] sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th
                                        class="px-4 py-3 text-left font-instrument text-theme-xs font-semibold uppercase tracking-wider text-[#9A6F0A] dark:text-[#E8C97A]">
                                        Descr.</th>
                                    <th
                                        class="px-4 py-3 text-right font-instrument text-theme-xs font-semibold uppercase tracking-wider text-[#9A6F0A] dark:text-[#E8C97A]">
                                        Monto</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-[#E8D9A0] bg-white dark:divide-[#3D3420] dark:bg-[#232126]">
                                <tr *ngIf="report.financials.movements.details.length === 0">
                                    <td colspan="2"
                                        class="px-4 py-10 text-center font-display text-[#46424A] dark:text-gray-400">
                                        No hay movimientos.
                                    </td>
                                </tr>
                                <tr *ngFor="let mov of report.financials.movements.details"
                                    class="transition-colors hover:bg-[#FBF0C9]/40 dark:hover:bg-[#252017]">
                                    <td
                                        class="px-4 py-3 font-instrument text-theme-sm text-[#46424A] dark:text-gray-300">
                                        <div class="flex items-center gap-2">
                                            <div class="w-1.5 h-1.5 rounded-full flex-shrink-0"
                                                [ngClass]="mov.type === 'IN' ? 'bg-success-500' : 'bg-error-500'"></div>
                                            <span class="truncate block max-w-[150px]" title="{{ mov.description }}">{{
                                                mov.description }}</span>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-right font-instrument text-theme-sm font-semibold"
                                        [ngClass]="mov.type === 'IN' ? 'text-success-600 dark:text-success-400' : 'text-error-600 dark:text-error-400'">
                                        {{ mov.type === 'IN' ? '+' : '-' }}{{ mov.amount | currency }}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Col 3: Checkout -->
            <div class="col-span-1 flex flex-col gap-6">

                <!-- Breakdown -->
                <div
                    class="bg-[#FFFDF7] dark:bg-[#232126] p-5 rounded-2xl border border-[#E8D9A0] dark:border-[#4A474D] shadow-theme-sm">
                    <h3 class="mb-4 font-instrument text-theme-xl font-semibold text-[#191817] dark:text-white">Resumen
                        Desglosado</h3>
                    <div class="space-y-3 text-sm">
                        <div
                            class="flex justify-between font-instrument text-theme-sm text-[#46424A] dark:text-gray-300">
                            <span>Fondo Inicial:</span>
                            <span>{{ report.financials.initialAmount | currency }}</span>
                        </div>
                        <div
                            class="flex justify-between font-instrument text-theme-sm text-[#46424A] dark:text-gray-300">
                            <span>Ventas (Efectivo):</span>
                            <span>+{{ report.financials.sales.cash | currency }}</span>
                        </div>
                        <div
                            class="flex justify-between font-instrument text-theme-sm text-[#46424A] dark:text-gray-300">
                            <span>Entradas Extra:</span>
                            <span>+{{ report.financials.movements.in | currency }}</span>
                        </div>
                        <div
                            class="flex justify-between border-b border-dashed border-[#E8D9A0] pb-3 font-instrument text-theme-sm text-[#46424A] dark:border-[#4A474D] dark:text-gray-300">
                            <span>Gastos/Salidas:</span>
                            <span class="text-error-500">-{{ report.financials.movements.out | currency }}</span>
                        </div>
                        <div
                            class="flex justify-between pt-2 font-instrument text-title-sm font-semibold text-[#191817] dark:text-white">
                            <span>Total Efectivo:</span>
                            <span class="text-[#C69214] dark:text-[#FAC600]">{{ report.financials.expectedCashInDrawer |
                                currency }}</span>
                        </div>
                    </div>
                </div>

                <!-- Close Button -->
                <button (click)="showCloseModal = true"
                    class="flex w-full items-center justify-center gap-2 rounded-xl bg-gradient-to-br from-[#C69214] to-[#FAC600] px-5 py-4 font-instrument text-base font-semibold text-[#191817] shadow-theme-md transition-all hover:from-[#9A6F0A] hover:to-[#C69214] hover:shadow-theme-lg active:scale-[0.98]">
                    Terminar Turno
                </button>
            </div>

        </div>

        <!-- Movement Modal -->
        <div *ngIf="showMovementModal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-[#191817]/60 backdrop-blur-sm p-4 animate-fade-in">
            <div
                class="w-full max-w-sm rounded-2xl border border-[#E8D9A0] bg-[#FFFDF7] p-6 shadow-theme-lg dark:border-[#4A474D] dark:bg-[#232126]">
                <h3 class="mb-1 font-instrument text-title-sm font-semibold text-[#191817] dark:text-white">
                    {{ movementType === 'IN' ? 'Registrar Entrada' : 'Registrar Salida/Gasto' }}
                </h3>
                <p class="mb-4 font-instrument text-theme-sm text-[#6B6560] dark:text-gray-500">Ingresa los detalles del
                    movimiento.</p>

                <form [formGroup]="movementForm" (ngSubmit)="submitMovement()" class="space-y-4">

                    <div>
                        <label
                            class="font-instrument text-theme-xs font-medium text-[#46424A] dark:text-gray-300 uppercase">M√©todo
                            de Pago</label>
                        <select formControlName="method"
                            class="mt-1 w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-instrument text-base text-[#191817] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:focus:border-[#FAC600]">
                            <option value="cash">üíµ Efectivo (Afecta Caja)</option>
                            <option value="transfer">üè¶ Transferencia / Dep√≥sito</option>
                            <option value="card">üí≥ Tarjeta</option>
                        </select>
                    </div>

                    <div>
                        <label
                            class="font-instrument text-theme-xs font-medium text-[#46424A] dark:text-gray-300 uppercase">Monto</label>
                        <input type="number" formControlName="amount"
                            class="mt-1 w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-instrument text-base text-[#191817] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:focus:border-[#FAC600]">
                    </div>
                    <div>
                        <label
                            class="font-instrument text-theme-xs font-medium text-[#46424A] dark:text-gray-300 uppercase">Descripci√≥n
                            / Motivo</label>
                        <textarea formControlName="description" rows="2"
                            class="mt-1 w-full rounded-xl border border-[#E8D9A0] bg-white px-4 py-2.5 font-instrument text-base text-[#191817] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:focus:border-[#FAC600]"></textarea>
                    </div>

                    <div class="flex gap-2 pt-2">
                        <button type="button" (click)="showMovementModal = false"
                            class="flex-1 rounded-xl border border-[#E8D9A0] bg-white px-5 py-2.5 font-instrument text-sm font-semibold text-[#191817] transition-all hover:bg-[#FBF0C9] dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:hover:bg-[#3a383d]">Cancelar</button>
                        <button type="submit" [disabled]="movementForm.invalid"
                            class="flex-1 flex items-center justify-center gap-2 rounded-xl bg-gradient-to-br from-[#C69214] to-[#FAC600] px-5 py-2.5 font-instrument text-sm font-semibold text-[#191817] transition-all hover:from-[#9A6F0A] hover:to-[#C69214] border border-transparent disabled:opacity-50">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Close Shift Modal -->
        <div *ngIf="showCloseModal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-[#191817]/60 backdrop-blur-sm p-4 animate-fade-in">
            <div
                class="w-full max-w-md rounded-2xl border border-[#E8D9A0] bg-[#FFFDF7] p-8 shadow-theme-lg dark:border-[#4A474D] dark:bg-[#232126]">
                <h3 class="mb-2 font-instrument text-title-sm font-semibold text-[#191817] dark:text-white">Cierre de
                    Caja
                </h3>
                <div
                    class="mb-6 rounded-xl border border-[#E8D9A0] bg-[#FBF0C9] p-4 dark:border-[#4A474D] dark:bg-[#3D3420]">
                    <p class="font-instrument text-theme-sm font-medium text-[#9A6F0A] dark:text-[#E8C97A]">
                        El sistema calcul√≥ <strong>{{ report?.financials?.expectedCashInDrawer | currency }}</strong> en
                        efectivo. Cuenta los billetes y monedas f√≠sicos e ingresa el total real.
                    </p>
                </div>

                <form [formGroup]="closeShiftForm" (ngSubmit)="closeShift()" class="space-y-4">
                    <div>
                        <label
                            class="block mb-1 font-instrument text-theme-sm font-medium text-[#46424A] dark:text-gray-300">Monto
                            Declarado
                            (F√≠sico)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 font-bold">$</span>
                            <input type="number" formControlName="totalDeclared"
                                class="w-full pl-8 pr-4 py-3 rounded-xl border-2 border-[#E8D9A0] bg-white text-xl font-bold text-[#191817] outline-none transition-all focus:border-[#C69214] dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:focus:border-[#FAC600]">
                        </div>

                        <!-- Real-time Validation Feedback -->
                        <div class="mt-2 text-right font-instrument">
                            <span *ngIf="calculatedDifference === 0" class="text-success-600 text-sm font-bold">‚úÖ Cuadra
                                perfecto</span>
                            <span *ngIf="calculatedDifference < 0" class="text-error-500 text-sm font-bold">‚ùå Faltante:
                                {{
                                calculatedDifference | currency }}</span>
                            <span *ngIf="calculatedDifference > 0" class="text-warning-500 text-sm font-bold">‚ö†Ô∏è
                                Sobrante:
                                {{
                                calculatedDifference | currency }}</span>
                        </div>
                    </div>

                    <div>
                        <label
                            class="block mb-1 font-instrument text-theme-sm font-medium text-[#46424A] dark:text-gray-300">Notas
                            del
                            Cierre</label>
                        <textarea formControlName="notes" placeholder="Alguna observaci√≥n..."
                            class="w-full rounded-xl border border-[#E8D9A0] bg-white p-3 font-instrument text-base text-[#191817] outline-none transition-all focus:border-[#C69214] focus:ring-2 focus:ring-[#C69214]/20 dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:focus:border-[#FAC600]"></textarea>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button type="button" (click)="showCloseModal = false"
                            class="flex-1 rounded-xl border border-[#E8D9A0] bg-white px-5 py-3 font-instrument text-base font-semibold text-[#191817] transition-all hover:bg-[#FBF0C9] dark:border-[#4A474D] dark:bg-[#232126] dark:text-white dark:hover:bg-[#3a383d]">Cancelar</button>
                        <button type="submit" [disabled]="closeShiftForm.invalid"
                            class="flex-1 flex items-center justify-center gap-2 rounded-xl bg-gradient-to-br from-[#C69214] to-[#FAC600] px-5 py-3 font-instrument text-base font-semibold text-[#191817] shadow-theme-sm transition-all hover:from-[#9A6F0A] hover:to-[#C69214] hover:shadow-theme-md active:scale-[0.98]">Confirmar
                            Cierre</button>
                    </div>
                </form>
            </div>
        </div>

    </div>